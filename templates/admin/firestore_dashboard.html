{% extends "admin/base_site.html" %}

{% block content %}
<div class="container-fluid dashboard py-2">
  <h1 class="h3 mb-3">PetMood Analytics</h1>

  <div class="row g-3">
    <div class="col-12 col-md-4">
      <a href="/admin-panel/users/" class="text-decoration-none text-reset">
        <div class="module border rounded p-3 h-100">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="h6 mb-0">Total Users</h2>
          </div>
          <p class="display-6 mb-0">{{ total_users }}</p>
        </div>
      </a>
    </div>
    <div class="col-12 col-md-4">
      <a href="/admin-panel/pets/" class="text-decoration-none text-reset">
        <div class="module border rounded p-3 h-100">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="h6 mb-0">Total Pets</h2>
          </div>
          <p class="display-6 mb-0">{{ total_pets }}</p>
        </div>
      </a>
    </div>
    <div class="col-12 col-md-4">
      <a href="/admin-panel/logs/" class="text-decoration-none text-reset">
        <div class="module border rounded p-3 h-100">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="h6 mb-0">Total Scans</h2>
          </div>
          <p class="display-6 mb-0">{{ total_scans }}</p>
        </div>
      </a>
    </div>
  </div>

  <div class="row g-3 mt-1 align-items-stretch">
    <div class="col-12 col-lg-6">
      <div class="module border rounded p-3 h-100">
        <h2 class="h6">Scans (last 7 days)</h2>
        <div style="height:260px;">
          <canvas id="scansChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="module border rounded p-3 h-100">
        <h2 class="h6">Emotion distribution</h2>
        <div style="height:260px;">
          <canvas id="emotionChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <p class="text-muted mt-3">This is a simple MVP dashboard pulling counts directly from Firestore.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const days = {{ chart_days|safe }};
  const values = {{ chart_values|safe }};
  const emoLabels = {{ emotion_labels|safe }};
  const emoValues = {{ emotion_values|safe }};

  const sctx = document.getElementById('scansChart').getContext('2d');
  new Chart(sctx, {
    type: 'line',
    data: { labels: days, datasets: [{ label: 'Scans', data: values, borderColor: '#0b7285', backgroundColor: 'rgba(11,114,133,0.2)' }] },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, precision: 0 } } }
  });

  const ectx = document.getElementById('emotionChart').getContext('2d');
  new Chart(ectx, {
    type: 'doughnut',
    data: { labels: emoLabels, datasets: [{ data: emoValues, backgroundColor: ['#22c55e','#ef4444','#f59e0b','#3b82f6','#6b7280'] }] },
    options: { responsive: true, maintainAspectRatio: false }
  });
</script>
{% endblock %}


